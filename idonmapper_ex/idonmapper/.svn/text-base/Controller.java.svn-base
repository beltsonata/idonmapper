package idonmapper;

import net.miginfocom.swing.MigLayout;
import java.awt.*;
import javax.swing.*;
import java.awt.event.*;
import java.util.*;

/**
 * The master application control module. Creates the idonmapper
 * components and links the disparate modules together.
 */
public class Controller
{
    private static Dimension d = new Dimension(1024, 768);
    private static boolean setUp = false;

    // Stack of user events for undo/redo functionality
    private static Stack<UserEvent> userEventStack;

    // Main application window
    private static JFrame f;

    // idonmapper main components
    private static HexPanel hexPanel;
    private static SetRetriever retriever;
    private static KeyboardInputPanel inputPanel;
    private static SuggestionPanel suggestionPanel;

    // Scrollpanes for HexPanel and SuggestionPanel
    private static JScrollPane  hexScroller,
                                suggestionScroller,
                                frameScroller;

    // Mouse / Key  / Action Listeners
    private static HexPanelMouseListener hexMouseListener;

    // simple container panel for the inputPanel and hexScroller.
    private static JPanel inputSuggestPanel;

    /* */
    public Controller()
    {
    }

    protected static SetRetriever getSetRetriever()
    {
        assert(retriever != null);
        return retriever;
    }

    protected static HexPanel getHexPanel()
    {
        return hexPanel;
    }
    protected static SuggestionPanel getSuggestionPanel()
    {
        return suggestionPanel;
    }
    protected static KeyboardInputPanel getInputPanel()
    {
        return inputPanel;
    }
    protected static JScrollPane getHexScroller()
    {
        return hexScroller;
    }

    /*
     * Creates the application (in turn, calling the other methods)
     */
    protected static void createComponents()
    {
        if(!setUp)
        {
            setUpSetRetriever();
            setUpHexPanel();
            setUpSuggestionPanel();
            setUpInputPanel();
            setUpFrame();
            userEventStack = new Stack<UserEvent>();

            setUp = true;
        }
    }

    private static void setUpHexPanelMouseListener()
    {
        hexMouseListener = new HexPanelMouseListener();
    }

    private static void setUpHexPanel()
    {
        System.out.println("setting up hex panel");
        hexPanel = new HexPanel(65, 50, 50);
        hexPanel.setLayout(null);
        setUpHexPanelMouseListener();
        setUpHexScroller();
    }

    private static void setUpSetRetriever()
    {
        System.out.println("setting up Google Sets retriever");
        retriever = new SetRetriever();
    }

    private static void setUpInputPanel()
    {
        System.out.println("setting up input panel");
        assert(hexPanel != null);
        inputPanel = new KeyboardInputPanel();
    }

    private static void setUpHexScroller()
    {
        hexScroller = new JScrollPane(hexPanel);
        hexScroller.getVerticalScrollBar().setUnitIncrement(16);
        assert(hexPanel != null);
        hexScroller.getViewport().setScrollMode(JViewport.BLIT_SCROLL_MODE);
        hexScroller.setPreferredSize(hexPanel.calculateMinimumSize());
    }

    /*
     * Creates the suggestions panel and associate it with the
     * SetRetriever object.
     */
    private static void setUpSuggestionPanel()
    {
        System.out.println("setting up suggestion panel");
        suggestionPanel = new SuggestionPanel();
        setUpSuggestionScroller();
        //suggestionPanel.addSetRetriever(retriever);
    }

    private static void setUpSuggestionScroller()
    {
        suggestionScroller = new JScrollPane(suggestionPanel);
        suggestionScroller.setVerticalScrollBarPolicy(JScrollPane.VERTICAL_SCROLLBAR_ALWAYS);
        suggestionScroller.setHorizontalScrollBarPolicy(JScrollPane.HORIZONTAL_SCROLLBAR_AS_NEEDED);
        suggestionScroller.getVerticalScrollBar().setUnitIncrement(8);
        suggestionScroller.setMinimumSize(suggestionPanel.getPreferredSize());
        suggestionScroller.setPreferredSize(suggestionPanel.getPreferredSize());
    }

    /*
     * Creates the main GUI window and adds the components to its
     * content pane.
     */
    private static void setUpFrame()
    {
        System.out.println("setting up main window");
        f = new JFrame("Idon Mapper");

        MigLayout frameLayout = new MigLayout();

        f.getContentPane().setLayout(frameLayout);
        f.setPreferredSize(d);
        f.setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);

        f.getContentPane().add(inputPanel, "span");
        f.getContentPane().add(hexScroller);
        //f.getContentPane().add(inputSuggestPanel);
        f.getContentPane().add(suggestionScroller);

        f.setPreferredSize(d);
        f.setVisible(true);
        f.pack();
    }
}
